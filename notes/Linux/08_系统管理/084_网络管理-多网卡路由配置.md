# 网络管理-多网卡路由配置
# 需求背景
通常企业服务器都会配置多块网卡连接不同的网络环境，其中一个用于连接局域网资源，可以访问内网相关服务。还有一个网卡用户连接互联网资源，可以让其他用户通过互联网地址访问。

![img_3008.png](https://raw.githubusercontent.com/Oumu33/notes/main/notes/images/img_3008.png)

| 网卡 | IP 地址 | 网关 | 子网 | 用途说明 |
| --- | --- | --- | --- | --- |
| ens224 | 192.168.8.100/24 | 192.168.8.1 | 默认路由 | 默认走这个接口 |
| ens160 | 192.168.10.100/24 | 192.168.10.2 | 特定网段访问 | 仅访问 192.168.10.0/24 |


# 配置步骤
### 设置 ens224 为默认路由接口（默认网关）
```bash
nmcli connection modify ens224 ipv4.gateway 192.168.8.1
nmcli connection modify ens224 ipv4.route-metric 100
nmcli connection modify ens224 ipv4.never-default no
```

### 禁用 ens160 的默认路由功能
```bash
nmcli connection modify ens160 ipv4.never-default yes
```

### 添加静态路由：让 192.168.10.0/24 走 ens160
```bash
nmcli connection modify ens160 +ipv4.routes "192.168.10.0/24 192.168.10.2"
```

### 配置 IP 模式为手动 & 自动连接
```bash
nmcli connection modify ens160 ipv4.method manual
nmcli connection modify ens224 ipv4.method manual

nmcli connection modify ens160 connection.autoconnect yes
nmcli connection modify ens224 connection.autoconnect yes
```

### 重启网络连接
```bash
nmcli connection down ens160 && nmcli connection up ens160
nmcli connection down ens224 && nmcli connection up ens224
```

### 验证路由表
```bash
# ip route
default via 192.168.8.1 dev ens224 proto static metric 100 
192.168.8.0/24 dev ens224 proto kernel scope link src 192.168.8.100 metric 100 
192.168.10.0/24 dev ens160 proto kernel scope link src 192.168.10.100 metric 100 
```

### 开启路由转发(可选)
如果你有如下需求，就需要开启：

+ 让其他设备通过这台主机访问另一个网段；
+ 比如它做了网关、NAT、防火墙、VPN 服务端等角色。

```bash
echo 1 > /proc/sys/net/ipv4/ip_forward
# 或永久开启：
echo "net.ipv4.ip_forward = 1" >> /etc/sysctl.d/99-sysctl.conf
sysctl -p
```


