# 网络管理-网络配置
# 一、网络配置
1. 查看网卡信息：

# ifconfig

+ 如果centos7 最小化安装没有ifconfig这个命令：

#yum install net-tools

1. centos7 网卡命名规则：

en： ethernet以太网卡

o：主板集成网卡

p：PCI独立网卡

s：热插拔网卡

nnn数字：MAC+主板信息（生产唯一序号）

+ 如：ifcfg-ens33 （以太热插拔）
1. centos7 网络配置



UP：网卡开启状态

RUNNING：网线连接状态

MULTICAST：支持组播

mut 1500：最大传输单元1500字节

inet：IP地址

netmask：子网掩码

broadcast：广播地址

ether：MAC地址

RX packets：发送包信息

RX error：发送错误信息

TX packets：接收包信息

TX error：接收错误信息

1. 网络相关配置文件
+ 网卡配置文件：

/etc/sysconfig/network-scripts/ifcfg-ens33

+ DNS配置文件:

/etc/resolv.conf

+ 网络主机绑定IP地址：

/etc/hosts

+ 计算机名：

/etc/hostname

# 二、修改IP地址：
1. 菜单方式修改:

nmtui



 



 

![img_4432.png](https://raw.githubusercontent.com/Oumu33/notes/main/notes/images/img_4432.png)

1. 修改网卡配置文件

![img_3104.png](https://raw.githubusercontent.com/Oumu33/notes/main/notes/images/img_3104.png)

TYPE：接口类型 Ethernet（以太网卡） Bridge（网桥）

BOOTPROTO：none（不指定类型，静态）dhcp（动态）satic（静态）

IPV4_FAILURE_FATAL：yes（ipv4配置失败后禁用设备）

NAME：网卡名称

UUID：唯一标示

DEVICE：设备名称

ONBOOT：启动网卡

IPADDR：IP地址

PREFIX：子网掩码

GATEWAY：网关

DNS1: DNS地址

 

 

1. 配置内容IP  MASK        ROUTE   主DNS/从DNS   
2. 配置方式：静态指定   ifcfg类命令：ifconfig   route         

        Ip类命令：link   addr   route

        配置文件命令：setup（centos-6）   nmtui  （centos-7）

+ 注意：默认最小化安装不能使用图形界面的配置工具，需额外安装相应组件

Centos-6：yum -y install setuptool ntsysv system-config-securitylevel-tui system-config-network-tui yum -y install authconfig-gtk system-config-keyboard

 

网络无需手动配置、实现动态分配   DHCP  

配置网络接口：以太网网卡名称--->Centos-6 eth[0,1,2,......]

                               Centos-7  enoXXXX 或者ensXXXX 或者 enpXXXX 或者enxXXXX

 

ifconfig系列命令详解：

ifconfig：网络信息显示和配置

      -a：显示所有活动网卡信息

![img_4288.png](https://raw.githubusercontent.com/Oumu33/notes/main/notes/images/img_4288.png)

      ethx：查看某个以太网卡配置信息



      ifconfig ethx IP/MASK    例如：ifconfig eth0 192.168.1.100/24   给ethx这个网络接口配置静态IP地址

![img_2192.png](https://raw.githubusercontent.com/Oumu33/notes/main/notes/images/img_2192.png)

      ifconfig ethx:x IP/MASK up   给网卡配置多个IP地址并生效

![img_4048.jpeg](https://raw.githubusercontent.com/Oumu33/notes/main/notes/images/img_4048.jpeg)

      Ifconfig ethx:x del IP     删除IP地址   例如：

![img_3376.jpeg](https://raw.githubusercontent.com/Oumu33/notes/main/notes/images/img_3376.jpeg)

 

 

ifup：激活某个非活动接口   例如ifup eth0

ifdown：下线某个活动接口

ifdown eth0

 

route命令：路由查看和配置  （路由匹配优先级--->主机路由--->网络路由--->默认路由）

注意：如果同一个主机设置多块网卡，不要设置多个默认路由，否则路由不生效

     -n：不解析

     add：指明路由   [ -net | -host | default ]  例如route add -host 192.168.2.100 gw 192.168.1.1

                                       route add -net 192.168.2.0/24 gw 192.168.1.1

                                       route add -net 0.0.0.0 netmask 0.0.0.0 gw 192.168.1.1 或者

                                       route add default gw 192.168.1.1

     示例：route add default gw 10.10.64.1  添加默认路由，网关为10.10.64.1

     del：删除路由（默认为default  网络位net 主机位host）                      例如： route del -host 192.169.2.100   

                                             示例：route del default   删除默认路由

 

主机名静态查询表：/etc/hosts    注意：主机名静态查询表必须同时验证双方主机名和IP地址的映射关系

 

DNS命令指定：在配置文件/etc/resolv.conf

              Nameserver DNS_server_IP

              域名解析查看：nslookup    

dig [-t 正向解析] [-x 反向解析]（需要安装bind-utils）

例如：



优先级：网卡配置文件高于/etc/resolv.conf

 

 

netstat命令：网络状态查看（连用组合 tan  tnl uan  unl ）

           -t：TCP

           -u：UDP

           -l：监听的连接

           -n：不反向解析（数字显示）

           -a：所有状态

           -p：显示监听端口的进程ID号和名称

           -i：统计接口数据

 

 

ip系列命令详解：（推荐使用）

ip [option] link | addr | route

link：show [interface | up]

     set dev NAME [up | down] 



addr：show [[dev] interface]  label可以指定别名

![img_3248.png](https://raw.githubusercontent.com/Oumu33/notes/main/notes/images/img_3248.png)

 

      add IP/MASK dev interface 为网卡添加地址 例如：ip addr add 192.168.1.100/24 dev eth0

![img_2352.png](https://raw.githubusercontent.com/Oumu33/notes/main/notes/images/img_2352.png)

 

      del：删除网卡上指定的IP地址，格式同上

![img_2528.png](https://raw.githubusercontent.com/Oumu33/notes/main/notes/images/img_2528.png)

 

      flush：清空所有IP地址（谨慎使用）                  例如ip addr flush dev eth0

![img_1904.png](https://raw.githubusercontent.com/Oumu33/notes/main/notes/images/img_1904.png)

 

route：管理路由

      show：



      add：添加路由    ip route add IP/MASK via next_hop  例如：ip route add 192.168.1.100 via 192.168.2.1



      del：删除路由    ip route del IP/MASK

![img_2624.png](https://raw.githubusercontent.com/Oumu33/notes/main/notes/images/img_2624.png)

 

 

ss命令：取代netstat命令，性能高效（选项基本一样  常见组合tan  tanlp  uan tnl  ）

        stat 监听状态

        监听状态：LISTEN 监听

        ESTABLISHED：已握手

        FIN_WAIT_1

        FIN_WAIT_2

        CLOSED 

        ......

 

 

永久修改网络配置和属性---->配置文件（/etc/sysconfig/network-scripts/ifcfg-INTERFACE）  立即生效需要重启网卡

参数详解：DEVICE    配置文件用到的网络设备，名称一致

          HWADDR  对应设备的MAC地址

          BOOTPROTO  引导协议  （dhcp  static  none）

          NM_CONTROLLED   网卡是否被network manage 管理

          ONBOOT：是否开启自动引导

          TYPE：接口类型，一般为以太网

          UUID：设备唯一标识

          IPADDR：IP地址指明

          NETMASK：默认子网掩码

          GATEWAY：默认网关

          DNS：DNS服务器指定  可有多个，为DNS1  DNS2

          PEERDNS：dhcp状态是否覆盖DNS配置文件内容。

路由配置文件：/etc/sysconfig/network-scripts/route-INTERFACE    （也可直接在网卡配置文件里设置，优先级更高）

参数详解：ADDRESS#=   目标地址

          NETMASK：掩码

          GATEWAY：网关

路由如何生效，优先级：网卡配置文件--->路由配置文件--->route或ip route自定义

 

图形界面配置网络属性（重启生效）

Centos-6：setup

Centos-7：nmtui

 

配置主机名   命令hostname xxx   永久生效----->修改配置文件centos-6（/etc/sysconfig/network） centos-7（/etc/hostname）

Centos-7命名回归：修改/etc/default/grub配置文件---->

                  添加GRUB_CMDLINE_LINUX="rd.lvm.lv=cl/root rd.lvm.lv=cl/swap rhgb quiet"

                  然后生成新的配置文件  grub2-mkconfig -o /etc/grub2.cfg

                  重启系统生效

 

CentOS7网络配置强大功能命令nmcli  ---->基于networkmanage          生产环境极少使用

显示所有网络链接：nmcli con show

显示所有网卡网络链接状态：nmcli dev status

显示所有活动网络链接：nmcli con show --active

显示网卡连接的配置：nmcli con show ens32

nmcli con modify ens32 +ipv4.addresses 192.168.45.100/24   添加网卡接口IP地址



 

 

 

 

 

开启路由转发功能

①：临时修改    echo "1" > /proc/sys/net/ipv4/ip_forward 

②：修改/etc/sysctl.conf配置文件

net.ipv4.ip_forward=1   然后sysctl -p  进行启用

 

 

其他网络相关命令

ping命令  -c：指定发包个数

          -w：ping不同时，指定每个包的超时时间

          -i：ping通时，指定每个包的间隔时间

          -s：指定每个包的数据大小

 

traceroute：跟踪数据包的路由追踪 （Linux的TTL为64）

          -n：不解析，以数字方式显示



 

 

service命令：管理Linux相关服务   （调用服务启停脚本）

service S_NAME start/stop/restart/reload/status  centos-6

systemctl start/stop/restart/reload/status S_NAME  centos-7

服务启停脚本   centos-6   /etc/init.d/xxx    链接地址   /etc/rc.d/init.d/xxx

               Centos-7  /usr/lib/systemd/system/xxx.service  （分为两种  service  和  target） 

系统内的所有服务列表     CentOS-6    chkconfig --list

                         CentOS-7    systemctl list-unit-files

服务开机是否自动启动     centos6     chkconfig  Server_NAME  ON/OFF

![img_4688.jpeg](https://raw.githubusercontent.com/Oumu33/notes/main/notes/images/img_4688.jpeg)

                         Centos7     systemctl enable/disable  Server_NAME


