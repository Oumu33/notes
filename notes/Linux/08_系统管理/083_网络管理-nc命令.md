# 网络管理-nc命令
# 命令简介
nc是netcat的简写，有着网络界的瑞士军刀美誉。因为它短小精悍、功能实用，被设计为一个简单、可靠的网络工具。比如大家很熟悉使用telnet测试tcp端口，而nc可以支持测试linux的tcp和udp端口，而且也经常被用于端口扫描，甚至把nc作为server以TCP或UDP方式侦听指定端口做简单的模拟测试。

# 安装
```bash
yum install -y nc
```

# 命令选项
+ <font style="color:rgb(25, 27, 31);">-l</font>

<font style="color:rgb(25, 27, 31);">用于指定nc将处于侦听模式。指定该参数，则意味着nc被当作server，侦听并接受连接，而非向其它地址发起连接。</font>

+ <font style="color:rgb(25, 27, 31);">-s</font>

<font style="color:rgb(25, 27, 31);">指定发送数据的源IP地址，适用于多网卡机</font>

+ <font style="color:rgb(25, 27, 31);">-u</font>

<font style="color:rgb(25, 27, 31);">指定nc使用UDP协议，默认为TCP</font>

+ <font style="color:rgb(25, 27, 31);">-v</font>

<font style="color:rgb(25, 27, 31);">输出交互或出错信息，新手调试时尤为有用</font>

+ <font style="color:rgb(25, 27, 31);">-w</font>

<font style="color:rgb(25, 27, 31);">超时秒数，后面跟数字</font>

+ <font style="color:rgb(25, 27, 31);">-z</font>

<font style="color:rgb(25, 27, 31);">表示zero，表示扫描时不发送任何数据</font>

# <font style="color:rgb(77, 77, 77);">nc使用示例</font>
## 测试环境
| 主机名 | ip | 角色 |
| --- | --- | --- |
| tiaoban | 192.168.10.100 | 服务器 |
| test | 192.168.10.50 | 客户端 |


## 测试tcp和udp端口
telnet不支持udp协议，所以我们可以使用nc，nc可以支持tcp也可以支持udp

+ 客户端测试服务器tcp 22端口

```bash
[root@test ~]# nc -z -v 192.168.10.100 22
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Connected to 192.168.10.100:22.
Ncat: 0 bytes sent, 0 bytes received in 0.09 seconds.
nc -z -v 192.168.10.12 22
```

+ 客户端测试服务器udp 111端口

```bash
[root@test ~]# nc -z -v -u 192.168.10.100 111
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Connected to 192.168.10.100:111.
Ncat: UDP packet sent successfully
Ncat: 1 bytes sent, 0 bytes received in 2.10 seconds.
```

## <font style="color:rgb(25, 27, 31);">监听端口</font>
+ 服务端监听tcp8888端口

```bash
[root@tiaoban ~]# nc -l 8888 -v
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Listening on 0.0.0.0:8888
```

+ 客户端连接服务端8888端口

```bash
[root@test ~]# nc -vz 192.168.10.100 8888
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Connected to 192.168.10.100:8888.
Ncat: 0 bytes sent, 0 bytes received in 0.10 seconds.
```

+ 服务端收到客户端连接信息

```bash
[root@tiaoban ~]# nc -l 8888 -v
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Listening on 0.0.0.0:8888
Ncat: Connection from 192.168.10.50.
Ncat: Connection from 192.168.10.50:36764.
```

## <font style="color:rgb(25, 27, 31);">扫描连接端口</font>
+ 客户端扫描服务端10-100端口

```bash
[root@es-test ~]# for port in {10..100}; do nc -zv 192.168.10.100 $port; done
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Connection refused.
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Connection refused.
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Connection refused.
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Connection refused.
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Connection refused.
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Connection refused.
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Connection refused.
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Connection refused.
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Connection refused.
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Connection refused.
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Connection refused.
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Connection refused.
Ncat: Version 7.92 ( https://nmap.org/ncat )
Ncat: Connected to 192.168.10.100:22.
Ncat: 0 bytes sent, 0 bytes received in 0.08 seconds.
```

+ 或者使用脚本，单独打印监听的端口

```bash
#!/bin/bash

target="192.168.10.100"
start_port=10
end_port=200

for port in $(seq $start_port $end_port); do
    if nc -zv $target $port 2>&1 | grep -q "succeeded"; then
        echo "Port $port is open"
    fi
done
```

## <font style="color:rgb(77, 77, 77);">传输文件</font>
+ 服务端（接收方）<font style="color:rgb(55, 65, 81);">监听端口12345并将接收的数据保存到文件中</font>

```bash
[root@tiaoban ~]# nc -l -p 12345 > received_file
```

+ 客户端（发送方）<font style="color:rgb(55, 65, 81);">将/etc/yum.repos.d/epel.repo文件发送到接收端IP为192.168.10.100、端口为12345的主机</font>

```bash
[root@test ~]# nc 192.168.10.100 12345 < /etc/yum.repos.d/epel.repo
```

+ <font style="color:rgb(77, 77, 77);">服务端（接收方）查看文件</font>

```bash
[root@tiaoban ~]# cat received_file 
[epel]
name=Extra Packages for Enterprise Linux $releasever - $basearch
# It is much more secure to use the metalink, but if you wish to use a local mirror
# place its address here.
#baseurl=https://download.example/pub/epel/$releasever/Everything/$basearch/
metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-$releasever&arch=$basearch&infra=$infra&content=$contentdir
enabled=1
gpgcheck=1
countme=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-$releasever

[epel-debuginfo]
name=Extra Packages for Enterprise Linux $releasever - $basearch - Debug
# It is much more secure to use the metalink, but if you wish to use a local mirror
# place its address here.
#baseurl=https://download.example/pub/epel/$releasever/Everything/$basearch/debug/
metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-debug-$releasever&arch=$basearch&infra=$infra&content=$contentdir
enabled=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-$releasever
gpgcheck=1

[epel-source]
name=Extra Packages for Enterprise Linux $releasever - $basearch - Source
# It is much more secure to use the metalink, but if you wish to use a local mirror
# place its address here.
#baseurl=https://download.example/pub/epel/$releasever/Everything/source/tree/
metalink=https://mirrors.fedoraproject.org/metalink?repo=epel-source-$releasever&arch=$basearch&infra=$infra&content=$contentdir
enabled=0
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-$releasever
gpgcheck=1
```

<font style="color:rgb(77, 77, 77);">  
</font>


