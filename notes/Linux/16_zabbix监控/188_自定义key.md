# 自定义key
# 一、自定义item
+ 需求：当前登录用户不超过2个，如果超过就报警->触发动作->通知
+ 流程：定义key->触发器->通知给谁，发邮件
1.  命令行获取当前登录用户个数

[root@bogon ~]# w|awk 'NR==1{print $4}'

1. 写入agent配置文件

[root@bogon ~]# vi /etc/zabbix/zabbix_agentd.conf     ###定义在106主机上了

UserParameter=log_user,/usr/bin/w|awk 'NR==1{print $4}'

1. 在zabbix server主机上

[root@bogon ~]# zabbix_get -s 192.168.137.106 -k log_user

+ 在添加之前，先用zabbix_get验证是不是能获取到，再添加到dashboard上。
1. 自定义key-item

需要监控什么（用户登录个数） 怎么监控（w|awk ）

agent 的key怎么传到server 通过agent配置文件UserParameter=log_user,shell command

1. zabbix的web界面

在106这主机上添加监控项 

画一个图形 数据实际从key来，key的数据从shell命令来

1. 定义触发器，超过2个用户登录就报警

表达式{bogon:log_user.last()}>2

1. 动作 邮件通知

报警主机： {HOST.NAME1}

报警key： {ITEM.KEY1}: {ITEM.VALUME1}

1.  动作中选择email发送消息

主机-监控项-触发器-动作-动作里添加email发送消息-设置报警媒介（发送邮件）-设置用户的报警媒介（接收邮件）


