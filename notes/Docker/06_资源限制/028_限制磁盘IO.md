# 限制磁盘IO
1. Block IO       是另一种可以限制容器使用的资源。Block IO 指的是磁盘的读写，docker 可通过设置权重、限制 bps 和 iops       的方式控制容器读写磁盘的带宽，下面分别讨论。
2. 默认情况下，所有容器能平等地读写磁盘，可以通过设置       --blkio-weight 参数来改变容器 block IO 的优先级。

--blkio-weight 与  --cpu-shares 类似，设置的是相对权重值，默认为 500。在下面的例子中，container_A 读写磁盘的带宽是 container_B  的两倍。

[root@docker  ~]# docker run -it --name container_A --blkio-weight  600 ubuntu   

[root@docker  ~]# docker run -it --name container_B --blkio-weight  300 ubuntu

3. 限制 bps 和 iops

bps 是 byte per  second，每秒读写的数据量。

iops 是 io per  second，每秒 IO 的次数。

+ 可通过以下参数控制容器的 bps 和 iops：

--device-read-bps，限制读某个设备的  bps。

--device-write-bps，限制写某个设备的  bps。

--device-read-iops，限制读某个设备的  iops。

--device-write-iops，限制写某个设备的  iops。

+ 下面这个例子限制容器写 /dev/sda 的速率为 30       MB/s

[root@docker  ~]# docker run -it --device-write-bps /dev/sda:30MB centos

我们来看看实验结果：



+ 通过 dd 测试在容器中写磁盘的速度。因为容器的文件系统是在       host /dev/sda 上的，在容器中写文件相当于对 host /dev/sda 进行写操作。另外，oflag=direct 指定用       direct IO 方式写文件，这样 --device-write-bps 才能生效。
+ 如果不限速，结果如下：

![img_3712.png](https://raw.githubusercontent.com/Oumu33/notes/main/notes/images/img_3712.png)


