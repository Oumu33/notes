# 内存限制
1. 与操作系统类似，容器可使用的内存包括两部分：物理内存和      swap。 
2. Docker 通过下面两组参数来控制容器内存的使用量。

-m 或 --memory：设置内存的使用限额，例如 100M, 2G。

--memory-swap：设置 内存+swap 的使用限额。

3. 示例：[root@docker      ~]# docker run -m 200M --memory-swap=300M ubuntu
+ 其含义是允许该容器最多使用 200M 的内存和 100M 的      swap。
4. 使用 progrium/stress      镜像来学习如何为容器分配内存。该镜像可用于对容器执行压力测试。执行如下命令：

`docker run -it -m 200M --memory-swap=300M progrium/stress --vm 1 --vm-bytes 280M` 

--vm 1：启动 1 个内存工作线程。

--vm-bytes 280M：每个线程分配 280M 内存。

+ 运行结果如下：

![img_944.png](https://raw.githubusercontent.com/Oumu33/notes/main/notes/images/img_944.png)

+ 因为 280M      在可分配的范围（300M）内，所以工作线程能够正常工作，其过程是：

分配 280M 内存。

释放 280M 内存。

再分配 280M 内存。

再释放 280M 内存。

一直循环......

+ 如果让工作线程分配的内存超过 300M，

`docker run -it -m 200M --memory-swap=300M progrium/stress --vm 1 --vm-bytes 310M`

--vm 1：启动 1 个内存工作线程。

--vm-bytes 310M：每个线程分配310M 内存。

+ 结果如下：



+ 分配的内存超过限额，stress 线程报错，容器退出。
5. 如果在启动容器时只指定 -m 而不指定      --memory-swap，那么 --memory-swap 默认为 -m 的两倍，比如：

`docker run -it -m 200M ubuntu` 

容器最多使用 200M 物理内存和 400M swap


