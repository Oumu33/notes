# 监控组件安装与使用
# 监控组件安装
参考文档：[https://www.cuiliangblog.cn/detail/section/15189166](https://www.cuiliangblog.cn/detail/section/15189166)

# metrics-server


1. 通过API Server的URL路径/apis/metrics.k8s.io/进行存取，并提供同样级别的安全性、稳定性及可靠性保证。
2. Metrics Server通过Kubernetes聚合器（kube-aggregator）注册到主API Server之上，而后基于kubelet的Summary API收集每个节点上的指标数据，并将它们存储于内存中然后以指标API格式提供，
3. Metrics Server基于内存存储，重启后数据将全部丢失，而且它仅能留存最近收集到的指标数据，因此，如果用户期望访问历史数据，就不得不借助于第三方的监控系统（如Prometheus等），或者自行开发以实现其功能。



# kubectl top命令


1. kubectl top命令可显示节点和Pod对象的资源使用信息，它依赖于集群中的资源指标API来收集各项指标数据。它包含有node和pod两个子命令，可分别用于显示Node对象和Pod对象的相关资源占用率。
2. 列出Node资源占用率命令的语法格式为“kubectl top node [-l label | NAME]”，例如下面显示所有节点的资源占用状况的结果中显示了各节点累计CPU资源占用时长及百分比，以及内容空间占用量及占用比例，可以使用标签选择器进行节点过滤

![img_720.png](https://raw.githubusercontent.com/Oumu33/notes/main/notes/images/img_720.png)

3. 名称空间级别的Pod对象资源占用率，一般应该限定名称空间及使用标签选择器过滤出目标Pod对象。命令的语法格式为“kubectl top pod [NAME | -l label] [--all-namespaces] [--containers=false|true]”，例如，下面显示kube-system名称空间中标签为“k8s-app=kube-dns”的所有Pod资源及其容器的资源占用状态：

![img_4368.png](https://raw.githubusercontent.com/Oumu33/notes/main/notes/images/img_4368.png)




