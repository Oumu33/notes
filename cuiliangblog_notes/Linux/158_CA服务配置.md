# CA服务配置

> 来源: Linux
> 创建时间: 2021-02-13T14:47:11+08:00
> 更新时间: 2026-01-11T09:37:23.367651+08:00
> 阅读量: 771 | 点赞: 0

---



 

# 一、实验目的
1.  掌握CA自建、CA签署、证书吊销

# 二、实验内容
1.     CA服务器：实现证书签署请求和签发 ，同时也搭建DNS服务，实现域名解析

2.     dovecot邮件服务器：实现向CA中心请求签证。并搭建邮件服务，提供客户机访问。

3.     客户机：访问邮件服务器的邮箱服务

# 三、实验环境
| 功能 | IP | 安装软件 |
| --- | --- | --- |
| CA服务器、DNS服务器 | 192.168.10.100 | bind、bind-utils、bind-libs |
| dovecot邮件服务器 | 192.168.10.150 | postfix、dovecot |
| 客户机 | 192.168.10.200 | 邮件客户端软件mutt |


# 四、<font style="color:white;">实验分析与设计思路</font>
1.  实验思路

![](https://via.placeholder.com/800x600?text=Image+27eb71632dc40fa4)

2.   CA自建

![](https://via.placeholder.com/800x600?text=Image+a9291f5b71fe6452)

3.   CA签署

![](https://via.placeholder.com/800x600?text=Image+f8576f4167424b5f)

4.   加密交互

![](https://via.placeholder.com/800x600?text=Image+8464845f3c8befff)

5.   证书吊销

![](https://via.placeholder.com/800x600?text=Image+ff0ccce80b72e069)

# 五、实验准备
1.   设置环境为同一网段

2.   关闭所有主机防火墙

3.   测试网络连通性

# 六、DNS服务器搭建
1.   安装软件包

![](https://via.placeholder.com/800x600?text=Image+44ef093be3b7ad9b)

2.   配置dns服务文件

![](https://via.placeholder.com/800x600?text=Image+43c870278c0df44a)

![](https://via.placeholder.com/800x600?text=Image+4cf4a0c1991f61d3)

![](https://via.placeholder.com/800x600?text=Image+6f1a72c456cafc2f)

3.   开启服务

![](https://via.placeholder.com/800x600?text=Image+1acb1fc7ce69d530)

4.   验证结果

![](https://via.placeholder.com/800x600?text=Image+3a49426f64275884)

# 七、自建CA
1.   CA服务器进行生成秘钥

![](https://via.placeholder.com/800x600?text=Image+3571737f1db211cf)

l  certs：证书存取库

l  crl：吊销列表

l  newcerts：新签署的证书

l  private：存放私钥

![](https://via.placeholder.com/800x600?text=Image+3c7033f75abe6a29)

l  genrsa：用于生成 RSA 密钥对的 OpenSSL 命令。

l  -out：输出文件保存位置

l  2048:表示秘钥强度也可以使1024

2.   更改密钥权限

![](https://via.placeholder.com/800x600?text=Image+dd15e2b1fabd4d71)

l  默认所属组和其他人有读权限，存在安全隐患，取消读权限

3.   CA方自己为自己签署根证书

![](https://via.placeholder.com/800x600?text=Image+e4860c9e6dd6b386)

l  req：生成证书请求和生成自签名证书

l  -new：生成新证书签署请求

l  -x509：专用CA生成自签证书

l  -key：生成请求时用到的私钥文件

l  -days：证书的有效期

l  -out /path ：证书的保存路径

4.   创建数据库索引文件以及序列号文件

![](https://via.placeholder.com/800x600?text=Image+2a38864aa161d818)

l  01表示生成的第一个证书id为01

l  index.txt用来存放相应序号对应的证书记录

![](https://via.placeholder.com/800x600?text=Image+ca4a83b4ee548e04)

# 八、CA签署
1.   请求方构建自己的私钥

![](https://via.placeholder.com/800x600?text=Image+ebc382a5364c14d6)

l  genrsa：用于生成 RSA 密钥对的 OpenSSL 命令。

l  -out：输出文件

l  2048:表示秘钥强度也可以使1024

2.   更改密钥权限

![](https://via.placeholder.com/800x600?text=Image+e6e2a96d261f4f47)

l  默认所属组和其他人有读权限，存在安全隐患，取消读权限

3.   提取公钥并生成证书申请请求文件

![](https://via.placeholder.com/800x600?text=Image+9250e719849e995a)

l  req：生成证书请求和生成自签名证书

l  -new：生成新证书签署请求

l  -key：生成请求时用到的私钥文件

l  -days：证书的有效期

l  -out /path ：证书的保存路径

4.   将证书申请请求文件发往CA方，让其签署

![](https://via.placeholder.com/800x600?text=Image+809845b283c6b1d8)

l  scp命令格式：scp 文件路径 接收方ip:路径

5.   查看自己的序列号和数据序列文件

![](https://via.placeholder.com/800x600?text=Image+2cc11961546e4c5b)

6.   CA服务器端查看请求方的证书请求文件并签署

![](https://via.placeholder.com/800x600?text=Image+6b67200360eb76e0)

l  ca：签署证书

l  -in：证书请求签署文件

l  -out：签发后的证书文件

l  -days：证书有效天数

7.   将已经签署的证书发还给请求方

![](https://via.placeholder.com/800x600?text=Image+e21e8f21326a69c0)

8.   请求方验证证书内容，将其证书放置在自己的SSL会话对应的配置文件目录即可发布证书。

![](https://via.placeholder.com/800x600?text=Image+67c5802630229862)

# 九、邮件服务搭建与验证
1.   安装相关软件包

![](https://via.placeholder.com/800x600?text=Image+01a8b13370c0f2d0)

2.   配置相关文件

![](https://via.placeholder.com/800x600?text=Image+0dd1c47e7a59b9e5)

![](https://via.placeholder.com/800x600?text=Image+09f76b051a242ee3)

3.  证书和邮件服务的私钥移动到上述指定的位置，并将之前的旧证书删除

![](https://via.placeholder.com/800x600?text=Image+94e288a88fee93cf)

4.   开启服务

![](https://via.placeholder.com/800x600?text=Image+ae0c0972aca5b63b)

5.   客户端安装软件包

![](https://via.placeholder.com/800x600?text=Image+227a2bffc65b52d0)

6.   客户端进行相关配置

l  mkdir /root/.mutt

l  cd /root/.mutt

l  vim muttrc

![](https://via.placeholder.com/800x600?text=Image+cd48d465a3c31076)

7.   进行验证

![](https://via.placeholder.com/800x600?text=Image+90f05cc56e167225)

# 十、证书吊销
1.   在客户端获取要吊销的证书的serial 与subject信息

![](https://via.placeholder.com/800x600?text=Image+2a3f79c563d8e707)

2.   在CA上，根据客户提交的serial与subject信息，对比检验是否与index.txt文件中的信息一致，一致吊销证书

![](https://via.placeholder.com/800x600?text=Image+9dae0d2bf86d6611)

3.   证书吊销

![](https://via.placeholder.com/800x600?text=Image+81543f56d7e8c5b1)

4.   生成吊销证书的编号（第一次吊销）

![](https://via.placeholder.com/800x600?text=Image+564eb377738983ca)

5.   更新证书吊销列表

![](https://via.placeholder.com/800x600?text=Image+f4cd538d324263d6)

6.   查看吊销文件

![](https://via.placeholder.com/800x600?text=Image+73a01fe5ef79e7fd)

# 十一、        实验总结
1.   CA自建证书与CA签署证书中的国家、省份、城市、公司名称必须一致，否则无法通过


