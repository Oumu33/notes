# KVM磁盘配置

> 来源: Linux
> 创建时间: 2021-02-16T16:13:28+08:00
> 更新时间: 2026-01-11T09:41:42.342460+08:00
> 阅读量: 754 | 点赞: 0

---

# 一、LVM作为storage pool
1. 宿主机添加磁盘

![](https://via.placeholder.com/800x600?text=Image+cc8c384aeb1061b0)

1. 给/dev/sdc分区

![](https://via.placeholder.com/800x600?text=Image+8ff58056a15ba38b)

1. 创建pv

![](https://via.placeholder.com/800x600?text=Image+fa41f0f68578fe4b)

1. 创建vg

![](https://via.placeholder.com/800x600?text=Image+08ab361efaa9b144)

1. 创建lv

![](https://via.placeholder.com/800x600?text=Image+485aedc0c61a22b7)

1. 创建了一个 Storage Pool 的定义文件

![](https://via.placeholder.com/800x600?text=Image+49b49489674cb9b1)

 

![](https://via.placeholder.com/800x600?text=Image+20fed1d2025b7302)

1. 加载定义文件

![](https://via.placeholder.com/800x600?text=Image+888cd268ac484697)

1. 启用vg1

![](https://via.placeholder.com/800x600?text=Image+8549fd0f1f8c3c21)

1. 查看使用vg1

![](https://via.placeholder.com/800x600?text=Image+94ea97e76ebd3af1)

# 二、创建虚拟机镜像（虚拟机安装位置）
1. 创建虚拟机镜像文件

![](https://via.placeholder.com/800x600?text=Image+7667aa09311580a7)

1. 查看虚拟机镜像文件

![](https://via.placeholder.com/800x600?text=Image+e4e96a3a8d9a7db1)

1. 使用虚拟机镜像文件

![](https://via.placeholder.com/800x600?text=Image+77a1d96faba397e0)

# 三、基础镜像、派生文件
1. 创建基础镜像文件

![](https://via.placeholder.com/800x600?text=Image+a75004e6e31852ca)

1. 指定后端文件
2. ![](https://via.placeholder.com/800x600?text=Image+7bd2a2ccf37347ae)
+ -f：指定文件的格式
+ -o：选项中使用了backing_file这个选项来指定其后端镜像文件，那么这个创建的镜像文件new_1.qcow2只记录操作过程仅记录与基础镜像文件的差异部分

![](https://via.placeholder.com/800x600?text=Image+904574deaee324c8)

1. 创建new_base.qcow2镜像文件作为另一个基础镜像

![](https://via.placeholder.com/800x600?text=Image+c68e3c7698025449)

1. 改变new_1基础镜像文件为new_base.qcow2

![](https://via.placeholder.com/800x600?text=Image+c763c8bfd96d0619)

1. 查看new_1镜像文件信息

![](https://via.placeholder.com/800x600?text=Image+e6a718edd5e750c7)

1. 使用新派生镜像

![](https://via.placeholder.com/800x600?text=Image+8b6e6698471ddfa2)

+ 派生镜像是在基础镜像的基础上，做个性化定制
1. 将基础镜像和派生镜像合并，生成新的基础镜像

![](https://via.placeholder.com/800x600?text=Image+12643dab226714dd)

1. 查看新基础镜像信息

![](https://via.placeholder.com/800x600?text=Image+e829dc56268f4139)

# 四、转换镜像格式
1. 查看初始镜像信息

![](https://via.placeholder.com/800x600?text=Image+dc29a65fc879b00d)

1. 将raw镜像转换为qcow2格式

![](https://via.placeholder.com/800x600?text=Image+99032fdc717ed936)

+ qemu-img    convert    -f         源格式    -O 目标格式    源磁盘         目标磁盘
1. 查看转换后的磁盘镜像信息

![](https://via.placeholder.com/800x600?text=Image+8440deabba36e4ab)

1. 压缩镜像文件（只有qcow2和qcow格式的镜像文件才支持压缩）

![](https://via.placeholder.com/800x600?text=Image+651c4a23875ab75a)

# 五、改变磁盘大小
1. 查看初始镜像信息

![](https://via.placeholder.com/800x600?text=Image+309f1b747c21c61d)

1. 增加磁盘大小

![](https://via.placeholder.com/800x600?text=Image+c1ffdda8d8f1e798)

1. 减少磁盘大小

![](https://via.placeholder.com/800x600?text=Image+6cc58b0f22b51cbf)

+ qcow2格式文件不支持缩小镜像的操作。

# 六、磁盘快照
1. 创建磁盘快照

![](https://via.placeholder.com/800x600?text=Image+54ecd07bad6b95e0)

1. 查看磁盘快照

![](https://via.placeholder.com/800x600?text=Image+9547d90274c51a6e)

1. 使用磁盘快照

![](https://via.placeholder.com/800x600?text=Image+6f291b83baba5108)

1. 删除磁盘快照

![](https://via.placeholder.com/800x600?text=Image+5ea448114dce2dd6)

# 七、基本镜像和增量镜像实验
| 虚拟机类型 | 虚拟机名称 | 镜像名称 | 配置文件名称 |
| --- | --- | --- | --- |
| 基本镜像 | centos7.1 | centos7.0.qcow2 | Centos7.1.xml |
| 增量镜像 | centos7-add | centos7-add.img | centos7-add.xml |


1. 查看基本镜像

![](https://via.placeholder.com/800x600?text=Image+3af553d03ef3fa21)

1. 创建增量镜像

![](https://via.placeholder.com/800x600?text=Image+a641ef49029227dc)

1. 创建增量镜像虚拟机xml配置文件

![](https://via.placeholder.com/800x600?text=Image+74ef4c077e21d5db)

![](https://via.placeholder.com/800x600?text=Image+317ed6878965d1e8)

1. 修改xml配置文件

![](https://via.placeholder.com/800x600?text=Image+abff77efd2e577e6)

![](https://via.placeholder.com/800x600?text=Image+e1399e70675182ed)

![](https://via.placeholder.com/800x600?text=Image+5667a4a271e9b979)

1. 加载增量虚拟机配置文件

![](https://via.placeholder.com/800x600?text=Image+1dbf1e9d1f397895)

1. 查看虚拟机列表并启动增量虚拟机

![](https://via.placeholder.com/800x600?text=Image+9ff588f3ee4820eb)

1. 查看基础虚拟机和增量虚拟机的原始存储大小

![](https://via.placeholder.com/800x600?text=Image+d1a428a631644a16)

1. 在增量虚拟机上创建1G大小文件

![](https://via.placeholder.com/800x600?text=Image+5e6a80e012a4c10f)

1. 查看基础虚拟机和增量虚拟机的当前存储大小

![](https://via.placeholder.com/800x600?text=Image+4d22dbf15d548872)

+ 基础镜像大小不变，增量镜像增加了1G


