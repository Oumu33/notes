# 集群查询性能优化

> 分类: ELK Stack > ES进阶
> 更新时间: 2026-01-10T23:33:40.246770+08:00

---

<font style="color:rgb(62, 62, 62);">首先有几个原则我们需要清楚：</font>

+ <font style="color:rgb(62, 62, 62);">ElasticSearch</font><font style="color:rgb(62, 62, 62);">不是关系型数据库，即使</font><font style="color:rgb(62, 62, 62);">ElasticSearch</font><font style="color:rgb(62, 62, 62);">支持嵌套、父子查询，但是会严重损耗</font><font style="color:rgb(62, 62, 62);">ElasticSearch</font><font style="color:rgb(62, 62, 62);">的性能，速度也很慢。</font>
+ <font style="color:rgb(62, 62, 62);">尽量先将数据计算出来放到索引字段中，不要查询的时候再通过es的脚本来进行计算。</font>
+ <font style="color:rgb(62, 62, 62);">尽量利用filter的缓存来查询</font>

![](../../images/img_1809.jpeg)

+ <font style="color:rgb(62, 62, 62);">设计上不要深度分页查询，否则可能会使得jvm内存爆满。</font>
+ <font style="color:rgb(62, 62, 62);">可以通过profile、explain工具来分析慢查询的原因。</font>
+ <font style="color:rgb(62, 62, 62);">严禁*号通配符为开头的关键字查询，我们可以利用不同的分词器进行模糊查询。</font>
+ <font style="color:rgb(62, 62, 62);">分片数优化，避免每次查询访问每一个分片，可以借助路由字段进行查询。</font>
+ <font style="color:rgb(62, 62, 62);">需要控制单个分片的大小：</font><font style="color:rgb(62, 62, 62);">这个上面有提到：查询类：20GB以内；日志类：50G以内。</font>
+ <font style="color:rgb(62, 62, 62);">读但是不写入文档的索引进行lucene段进行强制合并。</font>
+ <font style="color:rgb(62, 62, 62);">优化数据模型、数据规模、查询语句。</font>

