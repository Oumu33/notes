# DRF路由
## 一、路由Routers
> 对于视图集ViewSet，我们除了可以自己手动指明请求方式与动作action之间的对应关系外，还可以使用Routers来帮助我们快速实现路由信息。除此之外，Routers还能生成调试html页面
>

1. REST framework提供了两个router
+ SimpleRouter
+ DefaultRouter
2. register() 方法参数：
+ prefix - 用于此组路由的URL前缀。
+ viewset - 处理请求的viewset类。
+ base_name(可选) - 用于创建的URL名称的基本名称。如果不设置该参数，将根据视图集的queryset属性（如果有）来自动生成基本名称。注意，如果视图集不包括queryset属性，那么在注册视图集时必须设置base_name。
3. 视图集中包含附加action的

```python
class BookInfoModelViewSet(viewsets.ModelViewSet):
    # url_path自定义路由地址
    @action(methods=['get'], detail=False, url_path='get-last')
    def latest(self, request):
        pass
    @action(methods=['put'], detail=True)
    def read(self, request, pk):
        pass
# 自动生成的路由
v1/ ^books/$ [name='bookinfo-list']
v1/ ^books/get-last/$ [name='bookinfo-latest']
v1/ ^books/(?P<pk>[^/.]+)/$ [name='bookinfo-detail']
v1/ ^books/(?P<pk>[^/.]+)/read/$ [name='bookinfo-read']
```

3. DefaultRouter与SimpleRouter的区别是，DefaultRouter会多附带一个默认的API根视图，返回一个包含所有列表视图的超链接响应数据。
+ SimpleRouter

| URL 样式 | HTTP 方法 | 动作 | URL 名 |
| --- | --- | --- | --- |
| {prefix}/ | GET | list | {basename}-list |
| | POST | create | |
| {prefix}/{methodname}/ | GET, or as specified by `methods` argument | `@list_route` decorated method | {basename}-{methodname} |
| {prefix}/{lookup}/ | GET | retrieve | {basename}-detail |
| | PUT | update | |
| | PATCH | partial_update | |
| | DELETE | destroy | |
| {prefix}/{lookup}/{methodname}/ | GET, or as specified by `methods` argument | `@action(detaik=True)` decorated method | {basename}-{methodname} |


+ DefaultRouter

| URL 样式 | HTTP 方法 | 动作 | URL 名称 |
| --- | --- | --- | --- |
| [.format] | GET | automatically generated root view | api-root |
| {prefix}/[.format] | GET | list | {basename}-list |
| | POST | create | |
| {prefix}/{methodname}/[.format] | GET, or as specified by `methods` argument | `@list_route` decorated method | {basename}-{methodname} |
| {prefix}/{lookup}/[.format] | GET | retrieve | {basename}-detail |
| | PUT | update | |
| | PATCH | partial_update | |
| | DELETE | destroy | |
| {prefix}/{lookup}/{methodname}/[.format] | GET, or as specified by `methods` argument | `@action(detaik=True)` decorated method | {basename}-{methodname} |


## 二、示例
### 1. SimpleRouter
```python
from rest_framework import routers
from quickstart.views import BookInfoModelViewSet

router = routers.SimpleRouter()
router.register('books', BookInfoModelViewSet)
urlpatterns = router.urls
# 自动生成的路由
v1/ ^books/$ [name='bookinfo-list']
v1/ ^books/latest/$ [name='bookinfo-latest']
v1/ ^books/(?P<pk>[^/.]+)/$ [name='bookinfo-detail']
v1/ ^books/(?P<pk>[^/.]+)/read/$ [name='bookinfo-read']
```

### 2. DefaultRouter
```python
from rest_framework import routers
from quickstart.views import BookInfoModelViewSet

router = routers.DefaultRouter()
router.register('books', BookInfoModelViewSet)
urlpatterns = router.urls

# 自动生成的路由
v1/ ^books/$ [name='bookinfo-list']
v1/ ^books\.(?P<format>[a-z0-9]+)/?$ [name='bookinfo-list']
v1/ ^books/latest/$ [name='bookinfo-latest']
v1/ ^books/latest\.(?P<format>[a-z0-9]+)/?$ [name='bookinfo-latest']
v1/ ^books/(?P<pk>[^/.]+)/$ [name='bookinfo-detail']
v1/ ^books/(?P<pk>[^/.]+)\.(?P<format>[a-z0-9]+)/?$ [name='bookinfo-detail']
v1/ ^books/(?P<pk>[^/.]+)/read/$ [name='bookinfo-read']
v1/ ^books/(?P<pk>[^/.]+)/read\.(?P<format>[a-z0-9]+)/?$ [name='bookinfo-read']
```


