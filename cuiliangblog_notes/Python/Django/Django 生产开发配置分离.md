# Django 生产开发配置分离

> 分类: Python > Django
> 更新时间: 2026-01-10T23:34:29.357854+08:00

---

# 概述
## 配置分离优点
在项目开发中，我们经常需要在开发模式、生产模式、测试环境来回切换，如果是通过settings配置更改，无疑是非常麻烦的。

而且将数据库 key等信息直接放在settings文件中明文显示是非常不安全的做法，如果其他人看到settings文件就能轻易获取密钥信息。

通常在企业项目中，需要将开发和生产环境分离，并且将密钥等信息通过环境变量方式引入，而不是明文填写。

## 实现思路
核心思路，通过<font style="color:rgba(0, 0, 0, 0.9);">Django-environ管理配置文件敏感参数和环境变量，将开发和生产环境配置存放在.env目录下，通过环境变量形式加载不同环境的参数配置。</font>

<font style="color:rgba(0, 0, 0, 0.9);">完整的DRF生产开发配置参考项目：</font>[https://github.com/cuiliang0302/drf_template](https://github.com/cuiliang0302/drf_template)

# 安装Django-environ
```yaml
pip install django-environ
```

# 新增配置文件
如下图所示，在项目的根目录下创建envc目录，并新建.env.dev文件用于开发环境配置，.env.prod用于生产环境配置

![](../../images/img_4154.png)

## 开发环境配置
```bash
DEBUG=True
SECRET_KEY='django-insecure-ody#=i9ljnn2g+p!#gg7l12d*(dfa()&*^&fc6$f8tpc'
ALLOWED_HOSTS=*
DATABASE_URL='sqlite:///db.sqlite3'
DEFAULT_CACHE_RESPONSE_TIMEOUT=0
```

## 生产环境配置
```bash
DEBUG=False
SECRET_KEY=django-insecure-ody#=i9ljnn2g+p!#gg7lrck^t3mm87f+hv7-q+9!oc6$f8tpc
ALLOWED_HOSTS=api.test.cn,127.0.0.1
DEFAULT_CACHE_RESPONSE_TIMEOUT=3600
DATABASE_URL=mysql://root:123.com@mysql:3306/test?charset=utf8mb4
CACHE_URL=rediscache://redis:6379/0?client_class=django_redis.client.DefaultClient&password=123.com
```

由于我们通过.env文件对开发环境和生产环境做了区分，我们项目的配置文件settings.py实际上一个就够了，只需要在开头导入不同环境变量文件即可。

# settings读取配置
```bash
"""
Django settings for myblog_api project.

Generated by 'django-admin startproject' using Django 3.2.

For more information on this file, see
https://docs.djangoproject.com/en/3.2/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/3.2/ref/settings/
"""
from DRF.config.log import logger
import datetime
import os
from pathlib import Path
import environ

BASE_DIR = Path(__file__).resolve().parent.parent

env = environ.Env()
# 如果PROJECT_ENV=prod,读取.env.prod文件，否则读取.env.dev文件。
env_name = env.str('PROJECT_ENV', 'dev')
env.read_env(str(BASE_DIR) + '/envs/.env.%s' % env_name)
env_name == 'dev':  # [开发环境]
    # 静态资源目录
    STATICFILES_DIRS = [
        os.path.join(BASE_DIR, "static")
    ]
else:  # [生产环境]
    # 指定样式收集目录
    STATIC_ROOT = os.path.join(BASE_DIR, 'static')
    if CACHE_URL:
        # 设置redis作为django的缓存设置
        CACHES = {
            'default': env.cache(),
        }
        # 设置redis存储django的session信息
        SESSION_ENGINE = "django.contrib.sessions.backends.cache"
        SESSION_CACHE_ALIAS = "default"
```

# 生产模式运行
如果是docker方式启动服务，参考dockerfile

```bash
# 项目dockerfile镜像文件
FROM python:3.11
RUN ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && echo 'Asia/Shanghai' >/etc/timezone && pip config set global.index-url https://mirrors.aliyun.com/pypi/simple/
ADD . /opt/DRF/
RUN pip install -r /opt/DRF/requirements.txt
WORKDIR /opt/DRF/
EXPOSE 8000
# 开发环境
#CMD ["python","manage.py","runserver","0.0.0.0:8000"]
# 生产环境调试模式
# ENV PROJECT_ENV prod
#CMD ["PROJECT_ENV=prod","python","manage.py","runserver","0.0.0.0:8000"]
# 生产环境线上模式
ENV PROJECT_ENV prod
CMD ["gunicorn", "DRF.asgi:application", "-k", "uvicorn.workers.UvicornWorker","-c","gunicorn_conf.py"]
```

如果是终端启动服务，可通过如下命令

```bash
PROJECT_ENV=prod python manage.py runserver
或者
PROJECT_ENV=prod gunicorn DRF.asgi:application -k uvicorn.workers.UvicornWorker -c gunicorn_conf.py
```

