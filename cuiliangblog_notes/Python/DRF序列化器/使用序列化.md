# 使用序列化
## 序列化单个对象
```python
(venv) localhost:tutorial cuiliang$ python manage.py shell
Python 3.9.0 (default, Nov 20 2020, 18:44:50) 
[Clang 12.0.0 (clang-1200.0.32.27)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
(InteractiveConsole)
>>> from quickstart.models import BookInfo
>>> from quickstart.serializers import BookInfoSerializer
>>> # 获取对象
>>> book = BookInfo.objects.get(id=1)
>>> # 创建序列化器
>>> serializer = BookInfoSerializer(instance=book)
>>> # 将对象转换为json
>>> print(serializer.data)
{'id': 1, 'name': '三字经', 'releas_date': '2021-03-01', 'read': 0, 'is_delete': False}

#instance表示要序列化的对象
```

## 序列化多个对象（对象列表）
```python
>>> from quickstart.models import BookInfo
>>> from quickstart.serializers import BookInfoSerializer
>>> # 获取对象
>>> books = BookInfo.objects.all()
>>> # 创建序列化器
>>> serializer = BookInfoSerializer(instance=books, many=True)
>>> # 将对象转换为json
>>> print(serializer.data)
[OrderedDict([('id', 1), ('name', '三字经'), ('releas_date', '2021-03-01'), ('read', 0), ('is_delete', False)]), OrderedDict([('id', 2), ('name', '百家姓'), ('releas_dat021-03-01'), ('read', 0), ('is_delete', False)]), OrderedDict([('id', 3), ('name', '撸代码大全'), ('releas_date', '2021-03-13'), ('read', 123), ('is_delete', False)]), OdDict([('id', 4), ('name', '打豆豆'), ('releas_date', '2021-03-15'), ('read', 0), ('is_delete', False)]), OrderedDict([('id', 5), ('name', '吃饭'), ('releas_date', '20212'), ('read', 0), ('is_delete', False)])]

# many=True表示要序列化多个对象
```

## 关联对象序列化（对象外键序列化）
在上面的例子中，创建图书信息序列化器时，未对关联外键进行处理，现在修改serializers.py文件图书信息序列化器内容，新增外键属性。在定义外键属性时，根据时间需求，可以序列化后返回不同类型的结果

### 返回外键关联对象的id
```python
# 1.BookInfoSerializer新增序列化对象字段，属性为只读
author = serializers.PrimaryKeyRelatedField(read_only=True)
#或者使用queryset，查询结果一样
author = serializers.PrimaryKeyRelatedField(queryset=BookInfo.objects.all())

# 2.python manage.py shell测试
>>> from quickstart.models import BookInfo
>>> from quickstart.serializers import BookInfoSerializer
>>> # 获取对象
>>> book = BookInfo.objects.get(id=1)
>>> # 创建序列化器
>>> serializer = BookInfoSerializer(instance=book)
>>> # 将对象转换为json
>>> print(serializer.data)
{'id': 1, 'name': '三字经', 'releas_date': '2021-03-12', 'read': 0, 'is_delete': False, 'author': 2}
```

### 返回外键关联对象的__str__方法返回值
```python
# 1.BookInfoSerializer新增序列化对象字段
author = serializers.StringRelatedField(read_only=True)

# 2.python manage.py shell测试
>>> from quickstart.models import BookInfo
>>> from quickstart.serializers import BookInfoSerializer
>>> # 获取对象
>>> book = BookInfo.objects.get(id=1)
>>> # 创建序列化器
>>> serializer = BookInfoSerializer(instance=book)
>>> # 将对象转换为json
>>> print(serializer.data)
{'id': 1, 'name': '三字经', 'releas_date': '2021-03-12', 'read': 0, 'is_delete': False, 'author': '张三'}
```

### 返回userinfo模型所有字段数据
```python
# 1.BookInfoSerializer新增序列化对象字段
author = UserInfoSerializer()

# 2.python manage.py shell测试
>>> from quickstart.models import BookInfo
>>> from quickstart.serializers import BookInfoSerializer
>>> # 获取对象
>>> book = BookInfo.objects.get(id=1)
>>> # 创建序列化器
>>> serializer = BookInfoSerializer(instance=book)
>>> # 将对象转换为json
>>> print(serializer.data)
{'id': 1, 'name': '三字经', 'releas_date': '2021-03-01', 'read': 0, 'is_delete': False, 'author': OrderedDict([('id', 5), ('name', '安德森'), ('gender', 1), ('is_delete': False)])}
```

## 反向查询序列化（通过用户外键反向查询书籍）
+ **Django ORM 一对多反向查询**

```python
>>> from quickstart.models import BookInfo, UserInfo
>>> user = UserInfo.objects.get(id=1)
>>> user
<UserInfo: 张三>
>>> user.bookinfo_set.all()
<QuerySet [<BookInfo: 三字经>, <BookInfo: 撸代码大全>]>
```

### 反向查询关联对象的id
```python
# 1.UserInfoSerializer新增序列化对象字段，属性为只读,关联对象可能为多个，因此必须要加many
bookinfo_set = serializers.PrimaryKeyRelatedField(read_only=True, many=True)

# 2.python manage.py shell测试
>>> from quickstart.models import UserInfo
>>> from quickstart.serializers import UserInfoSerializer
>>> # 获取对象
>>> user = UserInfo.objects.get(id=1)
>>> # 创建序列化器
>>> serializer = UserInfoSerializer(instance=user)
>>> # 将对象转换为json
>>> print(serializer.data)
{'id': 1, 'name': '张三', 'gender': 0, 'is_delete': False, 'bookinfo_set': [1, 3]}
```

### 反向查询关联对象的__str__返回值
```python
# 1.UserInfoSerializer新增序列化对象字段，属性为只读,关联对象可能为多个，因此必须要加many
bookinfo_set = serializers.StringRelatedField(read_only=True, many=True)

# 2.python manage.py shell测试
>>> from quickstart.models import UserInfo
>>> from quickstart.serializers import UserInfoSerializer
>>> # 获取对象
>>> user = UserInfo.objects.get(id=1)
>>> # 创建序列化器
>>> serializer = UserInfoSerializer(instance=user)
>>> # 将对象转换为json
>>> print(serializer.data)
{'id': 1, 'name': '张三', 'gender': 0, 'is_delete': False, 'bookinfo_set': ['三字经', '撸代码大全']}
```



