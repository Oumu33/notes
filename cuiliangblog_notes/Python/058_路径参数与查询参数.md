# 路径参数与查询参数
# 路径参数
## 使用路径参数
路径参数（Path Parameter）是 URL 路径中的一部分，用来表示某个资源的标识。通常用于获取某个特定实体的信息，例如用户 ID、文章 ID 等。

示例：

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/users/{user_id}")
def get_user(user_id: int):
    """
    根据用户ID获取用户信息
    
    参数:
        user_id (int): 用户的唯一标识符
        
    返回值:
        dict: 包含用户ID的字典对象
    """
    return {"user_id": user_id}
```

访问 `http://127.0.0.1:8000/users/100` 将返回：

```plain
{
  "user_id": 100
}
```

+ `{user_id}` 是路径参数，FastAPI 会自动将 URL 中的部分提取出来并传给函数。
+ `user_id: int` 指定了类型为整数，如果传入字符串等类型不匹配的值，FastAPI 会自动返回 422 错误，表示请求验证失败。

## 路径参数类型转换
FastAPI 会根据类型提示自动完成转换与验证，支持的类型包括：

| 类型 | 示例 |
| --- | --- |
| `int` | `/items/123` |
| `float` | `/price/12.5` |
| `str` | `/search/keyword` |
| `bool` | `/flag/true`<br/> 或 `/flag/0` |


如果传入参数与类型不匹配，FastAPI 会自动返回验证失败的响应，无需你手动处理。

## 路径参数中的路径顺序
路径参数中的路径顺序很重要，你不能在两个路径参数不明确区分的情况下定义多个路径。例如：

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/files/{file_path}")
def read_file(file_path: str):
    """
    读取指定路径的文件信息
    
    参数:
        file_path (str): 文件路径参数，从URL中提取
        
    返回值:
        dict: 包含文件路径信息的字典，格式为{"file_path": file_path}
    """
    return {"file_path": file_path}

@app.get("/files/static")
def static_file():
    """
    处理静态文件请求
    
    返回值:
        dict: 包含静态文件消息的字典，格式为{"message": "Static file"}
    """
    return {"message": "Static file"}


```

访问 `/files/static` 时会优先匹配 `/files/{file_path}`，因为它更早被声明。因此建议将更“具体”的路径放在前面，或使用 `Path(..., regex=...)` 来更精确地控制。

# 查询参数
## 使用查询参数
查询参数（Query Parameter）是 URL 中以 `?` 开头，`key=value` 形式出现的部分，常用于过滤、排序、分页等可选参数。

示例：

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/items/")
def list_items(category: str = "all", limit: int = 10):
    """
    获取物品列表
    
    参数:
        category (str): 物品分类，默认为"all"表示所有分类
        limit (int): 返回物品数量限制，默认为10
    
    返回值:
        dict: 包含分类和限制数量的字典
    """
    return {"category": category, "limit": limit}

```

访问 `http://127.0.0.1:8000/items/?category=fruit&limit=5` 将返回：

```json
{
  "category": "fruit",
  "limit": 5
}
```

查询参数特点：

+ 无需写在路径中，而是通过 URL `?key=value` 的方式传递；
+ 可以有默认值，也可以声明为必填项（使用 `= Query(...)`）；
+ 不存在参数时会使用默认值。

## 路径参数与查询参数组合使用
你可以同时使用路径参数和查询参数，例如：

```python
from fastapi import FastAPI

app = FastAPI()

@app.get("/users/{user_id}/orders")
def get_orders(user_id: int, limit: int = 5):
    """
    获取指定用户的订单列表
    
    Args:
        user_id (int): 用户ID，用于标识要查询订单的用户
        limit (int, optional): 返回订单数量限制，默认值为5
        
    Returns:
        dict: 包含用户ID和限制数量的字典对象
    """
    return {"user_id": user_id, "limit": limit}

```

访问 `http://127.0.0.1:8000/users/42/orders?limit=10`，你将得到：

```json
{
  "user_id": 42,
  "limit": 10
}
```

## 路径参数的高级用法
FastAPI 支持你通过 `path` 类型获取包含 `/` 的路径内容：

```python
from fastapi import FastAPI
from fastapi import Path
app = FastAPI()



@app.get("/files/{file_path:path}")
def read_file(file_path: str = Path(...)):
    """
    读取文件路径信息

    该函数通过FastAPI的路径参数捕获功能，接收任意深度的文件路径，
    并将其作为响应返回。

    参数:
        file_path (str): 文件路径字符串，使用Path(...)表示这是一个必需的路径参数
                        路径参数允许捕获包含斜杠的完整路径

    返回值:
        dict: 包含file_path键的字典，值为传入的文件路径字符串
    """
    return {"file_path": file_path}

```

访问 `/files/docs/intro.md` 会返回：

```json
{
  "file_path": "docs/intro.md"
}
```

`:path` 表示该参数可以包含斜杠 `/`，适合表示文件路径、嵌套资源等场景。


