# 权限管理
## 权限简介
### 权限维度
space可控制不同的角色空间，kibana菜单项是否显示，而role可以具体配置该菜单是所有权限还是只读权限。

可用于控制用户对集群 API 和索引的访问权限；通过针对 Kibana Spaces 的安全功能，还可允许在 Kibana 中实现多租户。

![](https://via.placeholder.com/800x600?text=Image+9cfb118784176df9)

### 权限分离
RBAC / Role Based Access Control

+ Resource 面向指定的资源

index / aliases / documents / fields

+ Permissions 所具有的操作权限列表，如可读、可写等

Privileges 具体的权限，如可读权限

Role 最终被绑定到相关 User 才能生效，内置了 superuser、kibana_admin、kibana_user等一些常用角色，用于绑定到内置的用户

## Space维度
Space是Elastic 6.5版本引入的新特性，便于企业分组管理。

比如：开发、测试、运维、产品可以是不同的视角

案例：开发人员，只允许使用enterprise search模块，其他模块禁用

![](https://via.placeholder.com/800x600?text=Image+2e23d52725f0ed4c)

+ 新建spaces

![](https://via.placeholder.com/800x600?text=Image+4a046f46a91393e3)

+ 重新登陆，切换space

![](https://via.placeholder.com/800x600?text=Image+155df10fb4453221)

+ 查看功能模块

![](https://via.placeholder.com/800x600?text=Image+739bdd2f57590f5b)

## 角色维度
![](https://via.placeholder.com/800x600?text=Image+3cbaf22a4f3b27b5)

## 用户维度
![](https://via.placeholder.com/800x600?text=Image+47274aa1a917c35a)

## 操作实战
### 角色配置
+ 创建logs_index_rw 角色，对kibana_sample_data_logs这个index具备读和写权限

```json
# 请求
POST /_security/role/logs_index_rw
{
  "indices": [
    {
      "names": ["kibana_sample_data_logs"],
      "privileges": ["read","write"]
    }
  ]
}
# 响应
{
  "role" : {
    "created" : true
  }
}
```

+ 创建data_index_r角色，对data*的index具备读权限

```json
# 请求
POST /_security/role/user_data_r
{
  "indices": [
    {
      "names": ["data*"],
      "privileges": ["read"]
    }
  ]
}
# 响应
{
  "role" : {
    "created" : true
  }
}
```

### 用户配置
+ 创建用户tom，绑定角色logs_index_rw  user_data_r

```json
# 请求
POST /_security/user/tom
{
  "password": "123456",
  "roles": [
    "logs_index_rw",
    "user_data_r"
  ],
  "full_name": "tom",
  "email": "tom@example.com"
}
# 响应
{
  "created" : true
}
```

### 修改密码
```json
# 修改tom用户密码
POST /_security/user/tom/_password
{
  "password" : "123456"
}
```

![](https://via.placeholder.com/800x600?text=Image+b66aa3bc64572755)

+ 注意kibana访问注意需要配置kibana-role的权限，否则无法登录。

![](https://via.placeholder.com/800x600?text=Image+f30cd267e961c240)

## 文档
es角色管理：[https://www.elastic.co/guide/en/elasticsearch/reference/7.13/security-api-put-role.html](https://www.elastic.co/guide/en/elasticsearch/reference/7.13/security-api-put-role.html)

es用户管理：[https://www.elastic.co/guide/en/elasticsearch/reference/7.13/security-api-put-user.html](https://www.elastic.co/guide/en/elasticsearch/reference/7.13/security-api-put-user.html)

es权限说明：[https://www.elastic.co/guide/en/elasticsearch/reference/7.13/security-privileges.html#_run_as_privilege](https://www.elastic.co/guide/en/elasticsearch/reference/7.13/security-privileges.html#_run_as_privilege)

es使用指定用户请求：[https://www.elastic.co/guide/en/elasticsearch/reference/7.13/run-as-privilege.html](https://www.elastic.co/guide/en/elasticsearch/reference/7.13/run-as-privilege.html)


