# 搜索模板

> 来源: ELK Stack
> 创建时间: 2022-05-07T10:46:35+08:00
> 更新时间: 2026-01-11T09:26:22.180521+08:00
> 阅读量: 761 | 点赞: 0

---

搜索模板允许我们定义一个查询，查询中允许包含一些执行阶段指定的参数，他具备以下优点：

+ 减少重复代码
+ 便于在不同应用之间共享查询
+ 把查询逻辑从应用程序端解耦

## 定义搜索模板
```bash
# 请求
PUT _scripts/my-search-template
{
  "script": {
    "lang": "mustache",
    "source": {
      "query": {
        "match": {
          "hobby": "{{query_string}}"
        }
      },
      "from": "{{from}}",
      "size": "{{size}}"
    }
  }
}
# 响应
{
  "acknowledged" : true
}
```

## 使用搜索模板
```bash
# 请求
GET query_test/_search/template
{
  "id":"my-search-template",
  "params": {
    "query_string":"eat happy",
    "from":1,
    "size":2
  }
}
# 响应
{
  "took" : 4,
  "timed_out" : false,
  "_shards" : {
    "total" : 1,
    "successful" : 1,
    "skipped" : 0,
    "failed" : 0
  },
  "hits" : {
    "total" : {
      "value" : 3,
      "relation" : "eq"
    },
    "max_score" : 1.911587,
    "hits" : [
      {
        "_index" : "query_test",
        "_type" : "_doc",
        "_id" : "3",
        "_score" : 0.78795457,
        "_source" : {
          "id" : "3",
          "name" : "tom",
          "age" : 12,
          "email" : "query_test3@126.com",
          "hobby" : "sleep eat",
          "birth" : "2010-06-18"
        }
      },
      {
        "_index" : "query_test",
        "_type" : "_doc",
        "_id" : "2",
        "_score" : 0.6768591,
        "_source" : {
          "id" : "2",
          "name" : "join",
          "age" : 33,
          "email" : "test2@163.com",
          "hobby" : "study sleep eat",
          "birth" : "1989-12-12"
        }
      }
    ]
  }
}
```

## 模板默认值
<font style="color:rgb(52, 55, 65);">如果使用模板搜索时，未指定搜索值，将使用默认值搜索。</font>

```json
POST _render/template
{
  "source": {
    "query": {
      "match": {
        "message": "{{query_string}}"
      }
    },
    "from": "{{from}}{{^from}}0{{/from}}",
    "size": "{{size}}{{^size}}10{{/size}}"
  },
  "params": {
    "query_string": "hello world"
  }
}
```

## 参考文档
es搜索模板：[https://www.elastic.co/guide/en/elasticsearch/reference/7.13/search-template.html](https://www.elastic.co/guide/en/elasticsearch/reference/7.13/search-template.html)


