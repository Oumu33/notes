# 索引增删改查与配置
## 创建索引
+ 创建index

```json
# 请求
PUT /test_index
# 响应
{
  "acknowledged" : true,
  "shards_acknowledged" : true,
  "index" : "test_index"
}
```

+ 查看现有索引

```json
# 请求
GET /test_index
# 响应
{
  "test_index" : {
    "aliases" : { },
    "mappings" : { },
    "settings" : {
      "index" : {
        "routing" : {
          "allocation" : {
            "include" : {
              "_tier_preference" : "data_content"
            }
          }
        },
        "number_of_shards" : "1",
        "provided_name" : "test_index",
        "creation_date" : "1649766212649",
        "number_of_replicas" : "1",
        "uuid" : "XRu4zS44TAWMl8ogFy-Wqg",
        "version" : {
          "created" : "7130499"
        }
      }
    }
  }
}
```

+ 查看所有index

```json
# 请求
GET _cat/indices
# 响应
green open .newkibana_7.13.4_001              qpNTt0EJRCeqpylN7pWlCg 1 1 81    4   4.3mb   2.1mb
green open .async-search                      F0Sm3AyOTlSV_a0Q7BDs5Q 1 1  0    0    456b    228b
green open test_index                         XRu4zS44TAWMl8ogFy-Wqg 1 1  0    0    416b    208b
green open .kibana_task_manager_7.13.4_001    3xpboKi7RS-oXskxVjmshg 1 1 10 1086  10.7mb   5.4mb
green open myindex_new                        3ONYh6O9RDKdxmRzbr6FFQ 1 1  0    0    416b    208b
```

## 删除索引
+ 删除index

```json
# 请求
DELETE /test_index
# 响应
{
  "acknowledged" : true
}
```

## 索引配置
> 索引既可以在创建的时候指定配置，也可以在创建后修改配置
>

### 创建index时指定配置
```json
# 请求
PUT /test
{
  "settings": {
    "index":{
      "number_of_shards":3,
      "number_of_replicas":2
    }
  }
}
# 响应
{
  "acknowledged" : true,
  "shards_acknowledged" : true,
  "index" : "test"
}
# 验证
GET /test/_settings

{
  "test" : {
    "settings" : {
      "index" : {
        "routing" : {
          "allocation" : {
            "include" : {
              "_tier_preference" : "data_content"
            }
          }
        },
        "number_of_shards" : "3",
        "provided_name" : "test",
        "creation_date" : "1649767284252",
        "number_of_replicas" : "2",
        "uuid" : "kSssALKqQAK1IYZHfeeECQ",
        "version" : {
          "created" : "7130499"
        }
      }
    }
  }
}
```

### 创建index后更新设置
```json
# 请求
PUT /test/_settings
{
  "index": {
    "number_of_replicas": 4
  }
}
# 响应
{
  "acknowledged" : true
}
# 验证
GET /test/_settings

{
  "test" : {
    "settings" : {
      "index" : {
        "routing" : {
          "allocation" : {
            "include" : {
              "_tier_preference" : "data_content"
            }
          }
        },
        "number_of_shards" : "3",
        "provided_name" : "test",
        "creation_date" : "1649767284252",
        "number_of_replicas" : "4",
        "uuid" : "kSssALKqQAK1IYZHfeeECQ",
        "version" : {
          "created" : "7130499"
        }
      }
    }
  }
}
```

### index常用配置
```json
PUT twitter
{
  "settings" : {
    "number_of_shards" : "1",    // 索引分片数，创建后无法修改
    "number_of_replicas" : "1",  // 索引副本数
    "refresh_interval" : "30s",  // 当数据添加到索引后并不能马上被查询到，等到索引刷新后才会被查询到。 refresh_interval 配置的刷新间隔。默认1s
    "translog" : {
      "sync_interval" : "30s",   // 副本同步时间间隔
      "durability" : "async"     // 设置为async的话，Elasticsearch每5秒钟同步并提交一次translog。或者如果被设置为request（默认）的话，每次index，delete，update，bulk请求时就同步一次translog
    }
  }
}
```

## 参考文档
es index管理[https://www.elastic.co/guide/en/elasticsearch/reference/7.13/indices.html](https://www.elastic.co/guide/en/elasticsearch/reference/7.13/indices.html)

es index配置[https://www.elastic.co/guide/en/elasticsearch/reference/7.13/indices-update-settings.html](https://www.elastic.co/guide/en/elasticsearch/reference/7.13/indices-update-settings.html)


