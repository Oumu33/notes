# 复合查询

> 来源: Database
> 创建时间: 2021-02-12T00:18:26+08:00
> 更新时间: 2026-01-11T09:13:09.299459+08:00
> 阅读量: 653 | 点赞: 0

---

+ ![](https://via.placeholder.com/800x600?text=Image+ab9c7bb50d413504)
+  
+ ![](https://via.placeholder.com/800x600?text=Image+20f90e8f7d8def01)

# 一、并级运算
    1. **SQL**** UNION 操作符**
+ UNION  操作符用于合并两个或多个 SELECT 语句的结果集。
+ 请注意，UNION  内部的 SELECT 语句必须拥有相同数量的列。列也必须拥有相似的数据类型。同时，每条 SELECT 语句中的列的顺序必须相同。
+ **SQL UNION 语法**
+ SELECT column_name(s) FROM  table_name1  
  UNION  
  SELECT column_name(s) FROM table_name2
+ **注释：**默认地，UNION 操作符选取不同的值。如果允许重复的值，请使用 UNION ALL。
+ **SQL UNION ALL 语法**
+ SELECT column_name(s) FROM  table_name1  
  UNION ALL  
  SELECT column_name(s) FROM table_name2
+ 另外，UNION  结果集中的列名总是等于 UNION 中第一个 SELECT 语句中的列名。
    1. **下面的例子中使用的原始表：**
+ **Employees_China:**

| **E_ID** | **E_Name** |
| --- | --- |
| 01 | Zhang, Hua |
| 02 | Wang, Wei |
| 03 | Carter, Thomas |
| 04 | Yang, Ming |


+ **Employees_USA:**

| **E_ID** | **E_Name** |
| --- | --- |
| 01 | Adams, John |
| 02 | Bush, George |
| 03 | Carter, Thomas |
| 04 | Gates, Bill |


    1. **使用 UNION 命令**
+ **实例**
+ 列出所有在中国和美国的不同的雇员名：
+ <font style="color:black;">SELECT E_Name FROM  Employees_China  
</font><font style="color:black;">  </font><font style="color:#0000DD;">UNION</font><font style="color:black;">  
</font><font style="color:black;">  SELECT E_Name FROM Employees_USA</font>
+ **结果**

| **E_Name** |
| --- |
| Zhang, Hua |
| Wang, Wei |
| Carter, Thomas |
| Yang, Ming |
| Adams, John |
| Bush, George |
| Gates, Bill |


+ **注释：**这个命令无法列出在中国和美国的所有雇员。在上面的例子中，我们有两个名字相同的雇员，他们当中只有一个人被列出来了。UNION  命令只会选取不同的值。
    1. **UNION ALL**
+ UNION ALL  命令和 UNION 命令几乎是等效的，不过 UNION ALL 命令会列出所有的值。
+ SQL Statement 1  
  UNION ALL  
  SQL Statement 2
    1. **使用 UNION ALL 命令**
+ **实例：**
+ 列出在中国和美国的所有的雇员：
+ <font style="color:black;">SELECT E_Name FROM  Employees_China  
</font><font style="color:black;">  </font><font style="color:#0000DD;">UNION ALL</font><font style="color:black;">  
</font><font style="color:black;">  SELECT E_Name FROM Employees_USA</font>
+ **结果**

| **E_Name** |
| --- |
| Zhang, Hua |
| Wang, Wei |
| Carter, Thomas |
| Yang, Ming |
| Adams, John |
| Bush, George |
| Carter, Thomas |
| Gates, Bill |


# 二、复合查询示例
    1. 创建示例表
+ mysql>  create table class1 as select * from class where cno=1;
+ mysql>  insert into class1 values(5,'5班','董卓');
+ mysql>  select * from class;
+ mysql>  select * from class1;
+ ![](https://via.placeholder.com/800x600?text=Image+68244cf68a922ac7)
+  
+ ![](https://via.placeholder.com/800x600?text=Image+47970da754042a97)
    1. 求表class和class1的并集，重复记录只显示一次
+ mysql>  select * from class union select * from class1;
    - 默认排序为增序，顺序列1、列2、列3......
+ 也可以自定义排序，order  by写在语句的最后：
+ select  * from class union select * from class1 order by 2 desc,3,1;
+ select  * from class order by cname union select * from class1 order by 2  desc,3,1;  
+ ![](https://via.placeholder.com/800x600?text=Image+f1d404ccd315cfca)
    1. 求表class和class1的并集，重复记录重复显示
+ mysql>  select * from class union all select * from  class1;
+ 结果默认不排序
+ ![](https://via.placeholder.com/800x600?text=Image+dfa9f0261f160690)
    1. 求表class和class1的交集
+ mysql无intersect集合运算符，交集运算可以通过多表连接实现
+ mysql>  select c.cno,c.cname,c.teacher from class c join class1 c1 on c.cno=c1.cno;
+ ![](https://via.placeholder.com/800x600?text=Image+b47fce50bb857961)
    1. 求表class和class1的差集，即显示class表中在class1表中没有的行记录
+ mysql无minus集合运算符，差集运算可以通过多表连接实现
+ 1.mysql>  select * from class c left join class1 c1 on c.cno=c1.cno;
+ 2.mysql>  select * from class c left join class1 c1 on c.cno=c1.cno where c1.cno is  null;
+ 3.mysql>  select c.cno,c.cname,c.teacher from class c left join class1 c1 on  c.cno=c1.cno where c1.cno is null;
+ ![](https://via.placeholder.com/800x600?text=Image+1c20cb8b6ecf221c)
    1. 求表class1和class的差集，即显示class1表中在class表中没有的行记录
+ mysql>  select c1.cno,c1.cname,c1.teacher from class  c right join class1 c1 on c.cno=c1.cno where c.cno is null;
+ 或者
+ mysql>  select c1.cno,c1.cname,c1.teacher from  class1 c1 left join class c on c1.cno=c.cno where c.cno is null;
+ 左右连接是相对的，记一种就够了
+  


