# 存储
# <font style="color:rgb(36, 43, 60);">创建PV</font>
## 参考文档
[https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/configure-persistent-volume-storage/](https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/configure-persistent-volume-storage/)

## 例题
创建名为app-data的persistent volume，容量为2Gi，访问模式为ReadWriteOnce。volume类型为hostPath，位于/srv/app-data

## 解题思路
直接从官网复制yaml文件示例修改即可。

## 答案
```bash
[root@k8s-master ~]# cat pv.yaml 
apiVersion: v1
kind: PersistentVolume
metadata:
  name: task-pv-volume
spec:
  capacity:
    storage: 2Gi
  accessModes:
    - ReadWriteOnce
  hostPath:
    path: "/srv/app-data"
[root@k8s-master ~]# kubectl apply -f pv.yaml 
persistentvolume/task-pv-volume created
[root@k8s-master ~]# kubectl get pv
NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM              STORAGECLASS   REASON   AGE
app-data                                   2Gi        RWO            Retain           Available                                              4s
```

# <font style="color:rgb(36, 43, 60);">Pod使用PV</font>
## 参考文档
[https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/configure-persistent-volume-storage/](https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/configure-persistent-volume-storage/)

## 例题
创建一个新的PersistentVolumeClaim，名称：pv-volume，class：nfs-client，容量：10Mi

创建一个新的Pod，此Pod将作为volume挂载到PersistentVolumeClaim，名称：web-server，image：nginx，挂载路径：/usr/share/nginx/html。配置新的Pod，以对Volume具有ReadWriteOnce权限。

使用kubectl edit或者kubectl patch将PersistentVolumeClaim的容量扩展为70Mi，并记录更改

## 解题思路
直接从官网复制yaml文件示例修改即可。

使用kubectl edit命令，通过<font style="color:rgb(79, 79, 79);">--record</font>选项保存版本更新记录

## 答案
```bash
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: pv-volume
spec:
  storageClassName: nfs-client
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 10Mi
---
apiVersion: v1
kind: Pod
metadata:
  name: web-server
spec:
  volumes:
    - name: pv-storage
      persistentVolumeClaim:
        claimName: pv-volume
  containers:
    - name: web-server
      image: nginx
      ports:
        - containerPort: 80
          name: "http-server"
      volumeMounts:
        - mountPath: "/usr/share/nginx/html"
          name: pv-storage 
[root@k8s-master ~]# kubectl apply -f pod-pvc.yaml 
persistentvolumeclaim/pv-volume created
pod/web-server created
[root@k8s-master ~]# kubectl get pv | grep pv-volume
pvc-eafce149-97cd-417d-b4e5-25c96493fa11   10Mi       RWO            Delete           Bound       default/pv-volume   nfs-client              44s
[root@k8s-master ~]# kubectl get pod | grep web-server
web-server                      1/1     Running   0             65s
# 扩容PVC容量 
[root@k8s-master ~]# kubectl edit pvc pv-volume --record
修改pvc spec.resources.requests.storage字段
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 70Mi
```

<font style="color:rgb(36, 43, 60);"> </font>

 


