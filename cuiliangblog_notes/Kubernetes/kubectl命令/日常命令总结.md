# 日常命令总结

> 分类: Kubernetes > kubectl命令
> 更新时间: 2026-01-10T23:33:19.396098+08:00

---

# 一、查看命令


1. 查看所有namespace的pods运行情况  
`kubectl get pods --all-namespaces` 
2. 查看具体pods，记得后边跟namespace名字哦  
`kubectl get pods kubernetes-dashboard-76479d66bb-nj8wr --namespace=kube-system` 
3. 查看pods具体信息  
`kubectl get pods -o wide kubernetes-dashboard-76479d66bb-nj8wr --namespace=kube-system` 
4. 获取所有deployment  
`kubectl get deployment --all-namespaces` 
5. 查看kube-system namespace下面的pod/svc/deployment 等等（-o wide选项可以查看存在哪个对应的节点）  
`kubectl get pod /svc/deployment -n kube-system` 
6. 列出该 namespace 中的所有 pod 包括未初始化的  
`kubectl get pods --include-uninitialized` 
7. 查看deployment  
`kubectl get deployment nginx-app` 
8. 查看rc和servers  
`kubectl get rc,services` 
9. 查看pods结构信息（重点，通过这个看日志分析错误）对控制器和服务，node同样有效  
`kubectl describe pods xxxxpodsname --namespace=xxxnamespace` 
+ 其他控制器类似，就是kubectl get 控制器 控制器具体名称
10. 查看pod日志  
`kubectl logs $POD_NAME` 
11. 查看pod变量  
`kubectl exec my-nginx-5j8ok -- printenv | grep SERVICE` 



# 二、集群查看


1. 查看集群健康情况  
`kubectl get cs` 
2. 集群核心组件运行情况  
`kubectl cluster-info` 
3. 查看表空间名  
`kubectl get namespaces` 
4. 查看版本  
`kubectl version` 
5. 查看API  
`kubectl api-versions` 
6. 查看事件  
`kubectl get events` 
7. 获取全部节点  
`kubectl get nodes` 
8. 删除节点  
`kubectl delete node k8s2` 



# 三、创建资源


1. 创建资源  
`kubectl create -f ./nginx.yaml` 
2. 创建+更新，可以重复使用  
`kubectl apply -f xxx.yaml` 
3. 创建当前目录下的所有yaml资源  
`kubectl create -f .` 
4. 使用多个文件创建资源  
`kubectl create -f ./nginx1.yaml -f ./mysql2.yaml` 
5. 使用目录下的所有清单文件来创建资源  
`kubectl create -f ./dir` 
6. 使用 url 来创建资源  
`kubectl create -f https://git.io/vPieo` 
7. 创建带有终端的pod  
`kubectl run -i --tty busybox --image=busybox` 
8. 启动一个 nginx 实例  
`kubectl run nginx --image=nginx` 
9. 启动多个pod  
`kubectl run mybusybox --image=busybox --replicas=5` 
10. 获取 pod 和 svc 的文档  
`kubectl explain pods,svc` 



# 四、更新


1. 滚动更新 pod frontend-v1  
`kubectl rolling-update python-v1 -f python-v2.json` 
2. 更新资源名称并更新镜像  
`kubectl rolling-update python-v1 python-v2 --image=image:v2` 
3. 更新 frontend pod 中的镜像  
`kubectl rolling-update python --image=image:v2` 
4. 退出已存在的进行中的滚动更新  
`kubectl rolling-update python-v1 python-v2 --rollback` 
5. 基于 stdin 输入的 JSON 替换 pod  
`cat pod.json | kubectl replace -f -` 
6. 为 nginx RC 创建服务，启用本地 80 端口连接到容器上的 8000 端口  
`kubectl expose rc nginx --port=80 --target-port=8000` 
7. 更新单容器 pod 的镜像版本（tag）到 v4  
`kubectl get pod nginx-pod -o yaml | sed 's/\(image:myimage\):.*$/\1:v4/' | kubectl replace -f –` 
8. 添加标签  
`kubectl label pods nginx-pod new-label=awesome` 
9. 添加注解  
`kubectl annotate pods nginx-pod icon-url=http://goo.gl/XXBTWq` 
10. 自动扩展 deployment  
`kubectl autoscale deployment foo --min=2 --max=10` 



# 五、编辑资源


1. 编辑名为 docker-registry 的 service  
`kubectl edit svc/docker-registry` 
2. 修改启动参数  
`vim /etc/systemd/system/kubelet.service.d/10-kubeadm.conf` 



# 六、动态伸缩pod


1. 将foo副本集变成3个  
`kubectl scale --replicas=3 rs/foo` 
2. 缩放“foo”中指定的资源。  
`kubectl scale --replicas=3 -f foo.yaml` 
3. 将deployment/mysql从2个变成3个  
`kubectl scale --current-replicas=2 --replicas=3 deployment/mysql` 
4. 变更多个控制器的数量  
`kubectl scale --replicas=5 rc/foo rc/bar rc/baz` 
5. 查看变更进度  
`kubectl rollout status deploy deployment/mysql` 



# 七、label 操作


1. 增加节点lable值  
`kubectl label nodes node1 zone=north` 
2. 增加lable值 [key]=[value]  
`kubectl label pod redis-master-1033017107-q47hh role=master` 
3. 删除lable值  
`kubectl label pod redis-master-1033017107-q47hh role-` 
4. 修改lable值  
`kubectl label pod redis-master-1033017107-q47hh role=backend --overwrite` 



# 八、滚动升级


1. 配置文件滚动升级  
`kubectl rolling-update redis-master -f redis-master-controller-v2.yaml` 
2. 命令升级  
`kubectl rolling-update redis-master --image=redis-master:2.0` 
3. pod版本回滚  
`kubectl rolling-update redis-master --image=redis-master:1.0 --rollback` 



# 九、etcdctl 常用操作


1. 检查网络集群健康状态  
`etcdctl cluster-health` 
2. 带有安全认证检查网络集群健康状态  
`etcdctl --endpoints=https://192.168.71.221:2379 cluster-health` 
3. 查看集群成员  
`etcdctl member list` 
4. 设置网络配置  
`etcdctl set /k8s/network/config ‘{ “Network”: “10.1.0.0/16” }’` 
5. 获取网络配置  
`etcdctl get /k8s/network/config` 



# 十、删除资源


1. 根据label删除：

`kubectl delete pod -l app=flannel -n kube-system`   

2. 删除 pod.json 文件中定义的类型和名称的 pod  
`kubectl delete -f ./pod.json` 
3. 删除名为“baz”的 pod 和名为“foo”的 service  
`kubectl delete pod,service baz foo` 
4. 删除具有 name=myLabel 标签的 pod 和 serivce  
`kubectl delete pods,services -l name=myLabel` 
5. 删除具有 name=myLabel 标签的 pod 和 service，包括尚未初始化的  
`kubectl delete pods,services -l name=myLabel --include-uninitialized` 
6. 删除 my-ns namespace下的所有 pod 和 serivce，包括尚未初始化的  
`kubectl -n my-ns delete po,svc --all` 
7. 强制删除  
`kubectl delete pods prometheus-7fcfcb9f89-qkkf7 --grace-period=0 --force` 
8. 删除指定deployment  
`kubectl delete deployment kubernetes-dashboard --namespace=kube-system` 
9. 删除指定svc  
`kubectl delete svc kubernetes-dashboard --namespace=kube-system` 
10. 根据资源清单文件删除  
`kubectl delete -f kubernetes-dashboard.yaml` 
11. 强制替换，删除后重新创建资源。会导致服务中断。  
`kubectl replace --force -f ./pod.json` 

# 十一、交互


1. dump 输出 pod 的日志（stdout）  
`kubectl logs nginx-pod` 
2. dump 输出 pod 中容器的日志（stdout，pod 中有多个容器的情况下使用）  
`kubectl logs nginx-pod -c my-container` 
3. 流式输出 pod 的日志（stdout）  
`kubectl logs -f nginx-pod` 
4. 流式输出 pod 中容器的日志（stdout，pod 中有多个容器的情况下使用）  
`kubectl logs -f nginx-pod -c my-container` 
5. 交互式 shell 的方式运行 pod  
`kubectl run -i --tty busybox --image=busybox -- sh` 
6. 连接到运行中的容器  
`kubectl attach nginx-pod -i` 
7. 转发 pod 中的 6000 端口到本地的 5000 端口  
`kubectl port-forward nginx-pod 5000:6000` 
8. 在已存在的容器中执行命令（只有一个容器的情况下）  
`kubectl exec nginx-pod -- ls /` 
9. 在已存在的容器中执行命令（pod 中有多个容器的情况下）  
`kubectl exec nginx-pod -c my-container -- ls /` 
10. 显示指定 pod和容器的指标度量  
`kubectl top pod POD_NAME --containers` 
11. 进入pod  
`kubectl exec -ti podName /bin/bash` 



# 十二、调度配置


1. 标记 my-node 不可调度  
`kubectl cordon k8s-node` 
2. 清空 my-node 以待维护  
`kubectl drain k8s-node` 
3. 标记 my-node 可调度  
`kubectl uncordon k8s-node` 
4. 显示 my-node 的指标度量  
`kubectl top node k8s-node` 
5. 将当前集群状态输出到 stdout  
`kubectl cluster-info dump` 
6. 将当前集群状态输出到 /path/to/cluster-state  
`kubectl cluster-info dump --output-directory=/path/to/cluster-state` 
+ 如果该键和影响的污点（taint）已存在，则使用指定的值替换
7. 查看kubelet进程启动参数  
`kubectl taint nodes foo dedicated=special-user:NoSchedule` 
8. 查看日志  
`journalctl -u kubelet -f` 

# 十三、导出配置文件


1. 导出proxy  
`kubectl get ds -n kube-system -l k8s-app=kube-proxy -o yaml>kube-proxy-ds.yaml` 
2. 导出kube-dns  
`kubectl get deployment -n kube-system -l k8s-app=kube-dns -o yaml >kube-dns-dp.yaml`   
`kubectl get services -n kube-system -l k8s-app=kube-dns -o yaml >kube-dns-services.yaml` 
3. 导出所有 configmap  
`kubectl get configmap -n kube-system -o wide -o yaml > configmap.yaml` 



# 十四、复杂操作命令


1. 删除kube-system 下Evicted状态的所有pod  
`kubectl get pods -n kube-system |grep Evicted| awk ‘{print $1}’|xargs` 

# 十五、文件拷贝
1. 将pod里的文件拷贝到主机

```bash
kubectl cp -n 名称空间 pod名:文件相路径 文件目标位置
例：将pod里conf/defaults.ini拷贝到主机当前路径下，并命名为defaults.ini
kubectl cp -n monitoring -c grafana grafana-67755dc44d-x6chd:conf/defaults.ini ./defaults.ini
```

2. 将主机文件拷贝到pod

```bash
kubectl cp 主机文件路径 -n 分区 -c 容器 pod名:容器内绝对路径
例：将主机当前路径下的test.sql文件拷贝到pod的data目录下，并命名为testnew.sql
kubectl cp ./defaults.ini -n monitoring -c grafana grafana-67755dc44d-x6chd:conf/defaults.ini
```





