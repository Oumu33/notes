# 修改数据目录

> 分类: Kubernetes > 日常维护
> 更新时间: 2026-01-10T23:33:28.075807+08:00

---

我们知道，docker-ce的默认工作目录是/var/lib/docker，会存放docker镜像文件、容器日志及写到容器临时目录的文件等。

kubelet的默认工作目录是/var/lib/kubelet，会存放volume文件（包括emptyDir volume)、plugin文件等。

这实际存在一个风险：大量的镜像文件或容器日志等，可能把操作系统根分区容量占满，进而导致系统crash或k8s pod被频繁驱逐等异常发生。

我们在生产环境上，往往需要更改docker和kubelet的工作目录，将其改到另外一块数据盘的文件系统上，例如下文中的“/mnt/data”目录。

在修改数据目录前先将节点处于维护状态再开始操作。

# 修改docker目录
修改配置文件/etc/docker/daemon.json 

```plain
{
  "graph": "/mnt/data/docker"
}
```

重启docker service

```plain
systemctl daemon-reload
systemctl restart docker
```

确认更改生效

```yaml
docker info
```

看到 “Docker Root Dir: /mnt/data/docker” ，说明修改成功。

# 修改container目录
停止container服务

```plain
systemctl stop containerd
```

编辑 containerd 的配置文件 /etc/containerd/config.toml：

```plain
vim /etc/containerd/config.toml
# 将配置文件中默认的 root 目录从 /var/lib/containerd 修改为 /data/containerd：

root = "/data/containerd/root"
state = "/data/containerd/state"
```

创建新目录

```plain
mkdir -p /data/containerd
```

拷贝数据到新目录

```plain
rsync -avzh /var/lib/containerd/ /data/containerd/
```

启动 containerd 服务

```plain
systemctl start containerd
```

通过 crictl 工具查看 containerd 的 root 目录：

```plain
crictl info | grep -i root
```

# 修改kubelet目录
修改配置文件/etc/default/kubelet (默认不存在该文件，需要新增创建）

```yaml
KUBELET_EXTRA_ARGS=--root-dir=/mnt/data/kubelet
```

重启kubelet service

```plain
systemctl restart kubelet
```

确认修改生效

```plain
ps -aux |grep kubelet | grep root-dir
```

看到 “--root-dir=/mnt/data/kubelet”, 说明修改成功。

# 
