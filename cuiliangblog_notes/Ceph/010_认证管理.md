# 认证管理

> 来源: Ceph
> 创建时间: 2024-11-30T08:24:05+08:00
> 更新时间: 2026-01-11T09:43:34.701126+08:00
> 阅读量: 169 | 点赞: 0

---

# 认证基础
## 认证授权介绍
Ceph使用cephx协议对客户端进行身份认证。

cephx用于对ceph保存的数据进行认证访问授权，用于对访问ceph的请求进行认证和授权检测，与mon通信的请求都要经过ceph认证通过，也可以在mon节点关闭cephx认证，但关闭认证之后任何访问都将被允许，因此无法保证数据的安全性。

## 认证场景
1. 命令行与 ceph 集群操作，包括：
+ RadosGW 对象网关认证
+ RBD 认证
+ CephFS 用户认证
2. ceph 集群内部组件之间的通信

执行 ceph 命令时，会使用 client.admin 用户和/etc/ceph/ceph.client.admin.keyring 文件

```bash
root@ceph-1:~# cat /etc/ceph/ceph.client.admin.keyring 
[client.admin]
        key = AQBii0hnHNvZFxAAzs6IHqobafeOMF4aypRH7g==
        caps mds = "allow *"
        caps mgr = "allow *"
        caps mon = "allow *"
        caps osd = "allow *"
```

# 流程
## 认证授权流程
每个mon节点都可以对客户端进行身份认证并分支秘钥，因此多个mon节点就不存在单点故障和认证性能瓶颈。

mon节点会返回用于身份认证的数据结构，其中包含获取ceph服务时用到的session key，session key通过客户端密钥进行加密传输，而密钥是在客户端提前配置好的，保存在/etc/ceph/ceph.client.admin.keyring文件中。

客户端使用session key向mon请求所需要的服务，mon向客户端提供一个tiket，用于向实际处理数据的OSD等服务验证客户端身份，MON和OSD共享同一个secret，因此OSD会信任所有MON发放的tiket。tiket存在有效期，过期后重新发放。

注意:

+ CephX身份验证功能仅限制在Ceph的各组件之间，不能扩展到其他非ceph 组件
+ Ceph只负责认证授权，不能解决数据传输的加密问题

![](https://via.placeholder.com/800x600?text=Image+fb33edbb41cfbd11)

## 访问流程
无论ceph客户端是哪种类型，例如块设备、对象存储、文件系统，ceph都会在存储池中将所有数据存储为对象：

+ ceph用户需要拥有存储池访问权限，才能读取和写入数据；
+ ceph用户必须拥有执行权限才能使用ceph 的管理命令。

![](https://via.placeholder.com/800x600?text=Image+68f2bb142d5ae699)

<font style="color:rgb(0, 0, 0);background-color:rgb(238, 238, 238);">‍  
</font>![](https://via.placeholder.com/800x600?text=Image+bde0782153ca2a29)

# ceph 用户
用户是指个人(ceph 管理者)或系统参与者(MON/OSD/MDS)。通过创建用户，可以控制用户或哪个参与者能够访问ceph存储集群、以及可访问的存储池及存储池中的数据。

ceph支持多种类型的用户，但可管理的用户都属于client类型。区分用户类型的原因在于，MON/OSD/MDS等系统组件特使用cephx协议，但是它们为非客户端。

通过点号分割用户类型和用户名，格式为TYPE.ID，例如：client.admin。

```bash
[root@ceph-deploy ~]#cat /etc/ceph/ceph.client.admin.keyring 
[client.admin]
	key = AQDaQAtlGUUQAhAA7kJdEwwNvuC4SDd3Xt731g==
	caps mds = "allow *"
	caps mgr = "allow *"
	caps mon = "allow *"
	caps osd = "allow *"
```

# ceph 权限
## 权限介绍
ceph基于使能/能力（caps）来描述用户可针对MON/OSD或MDS使用的授权范围或级别。能力也用于限制对某一存储池内的数据或某个命名空间的访问。 Ceph 管理员用户可在创建或更新普通用户时赋予他相应的能力。

Ceph 把数据以对象的形式存于各存储池中。Ceph 用户必须具有访问存储池的权限才能够读写数据。另外，Ceph 用户必须具有执行权限才能够使用 Ceph 的管理命令。

通常的语法格式为：

```bash
{daemon-type} 'allow {capability}' [{daemon-type} 'allow {capability}']
```

## 权限说明
| 能力 | 描述 |
| --- | --- |
| allow | 授予允许能力 |
| r | 赋予用户读访问权限，需要监视器来检索CRUSH map |
| w | 赋予用户对对象的写访问权 |
| x | 使用户能够调用类方法(即读取和写入)并在监视器上执行身份验证操作 |
| class-read | 赋予用户调用类读取方法的能力，x的子集 |
| class-write | 赋予用户调用类写入方法的能力，x的子集 |
| * | 为用户提供特定守护进程或池的读、写和执行权限，以及执行管理命令的能力 |
| profile osd | 允许用户作为OSD连接到其他OSD或监视器，授予osd权限，使osd能够处理复制心跳流量和状态报告。 |
| profile bootstrap-osd | 允许用户引导一个OSD，这样用户在引导一个OSD时就有了添加key的权限 |
| profile rbd | 允许用户对Ceph块设备进行读写访问 |
| profile rbd-read-only | 为用户提供对Ceph块设备的只读访问权限 |


+ MON权限

包括r、w、x和`allow profile cap`(ceph的运行图)，例如:

```bash
mon 'allow rwx'
mon 'allow profile osd'
```

+ OSD权限

包括r、w、x、class-read、class-write(类读取）和 profile osd(类写入)，另外OSD能力还允许进行存储池和名称空间设置。

```bash
osd 'allow capability' [pool=poolname][namespace=namespace-name]
```

+ MDS权限

只需要allow或空都表示允许

```bash
mds 'allow'
```




